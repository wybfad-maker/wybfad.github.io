<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¾®ä¿¡æˆæƒç™»å½•</title>
  <script src="https://unpkg.com/vue@2.6.14/dist/vue.js"></script>
  <script src="https://unpkg.com/@dcloudio/uni-ui/lib/uni-badge/uni-badge.vue"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, sans-serif;
    }

    body {
      background-color: #f8f8f8;
      color: #333;
      line-height: 1.6;
    }

    .container {
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 30px 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      text-align: center;
      margin-bottom: 20px;
    }

    .logo {
      width: 80px;
      height: 80px;
      margin: 0 auto 20px;
      background: linear-gradient(135deg, #07C160, #09BB07);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 36px;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 10px;
      color: #333;
    }

    .subtitle {
      color: #666;
      font-size: 14px;
      margin-bottom: 30px;
    }

    .login-btn {
      background-color: #07C160;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 14px 20px;
      font-size: 16px;
      width: 100%;
      cursor: pointer;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin: 20px 0;
    }

    .login-btn:hover {
      background-color: #06AD56;
    }

    .login-btn:active {
      background-color: #059A4C;
    }

    .login-btn i {
      font-size: 20px;
    }

    .divider {
      display: flex;
      align-items: center;
      margin: 30px 0;
      color: #999;
      font-size: 14px;
    }

    .divider::before,
    .divider::after {
      content: "";
      flex: 1;
      height: 1px;
      background-color: #e5e5e5;
    }

    .divider span {
      padding: 0 15px;
    }

    .other-login {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .other-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f5;
      cursor: pointer;
      transition: background 0.3s;
    }

    .other-btn:hover {
      background: #e5e5e5;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, .3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .result-card {
      text-align: left;
    }

    .user-info {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin-right: 15px;
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
    }

    .user-details {
      flex: 1;
    }

    .user-name {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .user-id {
      color: #666;
      font-size: 14px;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .info-label {
      color: #666;
    }

    .info-value {
      font-weight: 500;
    }

    .logout-btn {
      background-color: #f0f0f0;
      color: #333;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 16px;
      width: 100%;
      cursor: pointer;
      margin-top: 20px;
      transition: background-color 0.3s;
    }

    .logout-btn:hover {
      background-color: #e5e5e5;
    }

    .error-message {
      color: #e64340;
      background: #fef0ef;
      padding: 12px;
      border-radius: 8px;
      margin: 15px 0;
      font-size: 14px;
      text-align: left;
    }

    .footer {
      text-align: center;
      color: #999;
      font-size: 12px;
      margin-top: 30px;
    }
  </style>
</head>

<body>
  <div id="app">
    <div class="container">
      <div class="card" v-if="!isLoggedIn && !isLoading">
        <div class="logo">
          <span>å¾®</span>
        </div>
        <h1>å¾®ä¿¡æˆæƒç™»å½•</h1>
        <p class="subtitle">è¯·ä½¿ç”¨å¾®ä¿¡æ‰«ç æˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æˆæƒç™»å½•</p>

        <button class="login-btn" @click="wechatLogin">
          <span v-if="!loadingAuth">å¾®ä¿¡ä¸€é”®ç™»å½•</span>
          <div v-else>
            <div class="loading"></div>
            æˆæƒä¸­...
          </div>
        </button>

        <div class="divider">
          <span>å…¶ä»–ç™»å½•æ–¹å¼</span>
        </div>

        <div class="other-login">
          <div class="other-btn" title="æ‰‹æœºå·ç™»å½•">ğŸ“±</div>
          <div class="other-btn" title="è´¦å·å¯†ç ç™»å½•">ğŸ‘¤</div>
          <div class="other-btn" title="é‚®ç®±ç™»å½•">ğŸ“§</div>
        </div>
      </div>

      <div class="card" v-if="isLoading">
        <div class="logo">
          <span>å¾®</span>
        </div>
        <h1>ç™»å½•ä¸­...</h1>
        <p class="subtitle">æ­£åœ¨å¤„ç†æˆæƒä¿¡æ¯ï¼Œè¯·ç¨å€™</p>
        <div style="margin: 30px 0;">
          <div class="loading" style="border-top-color: #07C160; width: 40px; height: 40px;"></div>
        </div>
      </div>

      <div class="card result-card" v-if="isLoggedIn && !isLoading">
        <div class="user-info">
          <div class="avatar">
            <span>ğŸ‘¤</span>
          </div>
          <div class="user-details">
            <div class="user-name">{{ userInfo.nickname || 'å¾®ä¿¡ç”¨æˆ·' }}</div>
            <div class="user-id">ID: {{ userInfo.openid || 'wx_123456789' }}</div>
          </div>
        </div>

        <div class="info-item">
          <span class="info-label">ç™»å½•æ–¹å¼</span>
          <span class="info-value">å¾®ä¿¡æˆæƒç™»å½•</span>
        </div>
        <div class="info-item">
          <span class="info-label">ç™»å½•æ—¶é—´</span>
          <span class="info-value">{{ loginTime }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">æˆæƒçŠ¶æ€</span>
          <span class="info-value" style="color: #07C160;">å·²æˆæƒ</span>
        </div>

        <button class="logout-btn" @click="logout">é€€å‡ºç™»å½•</button>
      </div>

      <div class="card" v-if="errorMessage">
        <div class="logo" style="background: linear-gradient(135deg, #e64340, #d81e06);">
          <span>!</span>
        </div>
        <h1>æˆæƒå¤±è´¥</h1>
        <div class="error-message">
          {{ errorMessage }}
        </div>
        <button class="login-btn" @click="retryLogin" style="background-color: #e64340;">
          é‡æ–°å°è¯•
        </button>
      </div>

      <div class="footer">
        <p>Â© 2023 ç¤ºä¾‹åº”ç”¨ | éµå¾ªå¾®ä¿¡å¼€æ”¾å¹³å°è§„èŒƒ</p>
      </div>
    </div>
  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        isLoggedIn: false,
        isLoading: false,
        loadingAuth: false,
        errorMessage: '',
        userInfo: {},
        loginTime: ''
      },
      mounted () {
        // æ£€æŸ¥URLä¸­æ˜¯å¦æœ‰å¾®ä¿¡æˆæƒè¿”å›çš„code
        this.checkWechatAuthCode();
      },
      methods: {
        // å¾®ä¿¡ç™»å½•æŒ‰é’®ç‚¹å‡»
        wechatLogin () {
          this.loadingAuth = true;
          this.errorMessage = '';

          // æ¨¡æ‹Ÿå‘èµ·å¾®ä¿¡æˆæƒè¯·æ±‚
          setTimeout(() => {
            // åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œåº”è¯¥è·³è½¬åˆ°å¾®ä¿¡æˆæƒURL
            // window.location.href = this.getWechatAuthUrl();

            // æ¨¡æ‹ŸæˆæƒæˆåŠŸ
            this.simulateWechatAuth();
          }, 1500);
        },

        // ç”Ÿæˆå¾®ä¿¡æˆæƒURLï¼ˆå®é™…é¡¹ç›®ä¸­ä½¿ç”¨ï¼‰
        getWechatAuthUrl () {
          const appId = 'your_wechat_appid'; // æ›¿æ¢ä¸ºå®é™…AppID
          const redirectUri = encodeURIComponent(window.location.href.split('?')[0]);
          const state = 'STATE'; // å¯è‡ªå®šä¹‰å‚æ•°ï¼Œç”¨äºé˜²æ­¢CSRFæ”»å‡»
          const scope = 'snsapi_userinfo'; // æˆæƒä½œç”¨åŸŸ

          return `https://open.weixin.qq.com/connect/oauth2/authorize?appid=${appId}&redirect_uri=${redirectUri}&response_type=code&scope=${scope}&state=${state}#wechat_redirect`;
        },

        // æ£€æŸ¥URLä¸­æ˜¯å¦æœ‰å¾®ä¿¡æˆæƒè¿”å›çš„code
        checkWechatAuthCode () {
          // æ¨¡æ‹Ÿä»URLè·å–code
          const urlParams = new URLSearchParams(window.location.search);
          const code = urlParams.get('code');

          if (code) {
            this.isLoading = true;
            // åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œåº”è¯¥å°†codeå‘é€åˆ°åç«¯æ¢å–access_tokenå’Œç”¨æˆ·ä¿¡æ¯
            setTimeout(() => {
              this.exchangeCodeForToken(code);
            }, 1000);
          }
        },

        // ä½¿ç”¨codeæ¢å–access_tokenï¼ˆå®é™…é¡¹ç›®ä¸­ç”±åç«¯å®Œæˆï¼‰
        exchangeCodeForToken (code) {
          // æ¨¡æ‹ŸAPIè¯·æ±‚
          setTimeout(() => {
            // æ¨¡æ‹ŸæˆåŠŸå“åº”
            this.isLoading = false;
            this.isLoggedIn = true;
            this.userInfo = {
              openid: 'wx_123456789',
              nickname: 'å¾®ä¿¡ç”¨æˆ·',
              sex: 1,
              province: 'å¹¿ä¸œçœ',
              city: 'æ·±åœ³å¸‚',
              country: 'ä¸­å›½',
              headimgurl: ''
            };
            this.loginTime = new Date().toLocaleString();

            // åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œåº”è¯¥å­˜å‚¨tokenç­‰ä¿¡æ¯
          }, 1500);
        },

        // æ¨¡æ‹Ÿå¾®ä¿¡æˆæƒæµç¨‹ï¼ˆä»…ç”¨äºæ¼”ç¤ºï¼‰
        simulateWechatAuth () {
          this.loadingAuth = false;

          // æ¨¡æ‹Ÿæˆæƒå¼¹çª—
          if (confirm('æ˜¯å¦åŒæ„"ç¤ºä¾‹åº”ç”¨"è·å–æ‚¨çš„å¾®ä¿¡ä¸ªäººä¿¡æ¯ï¼Ÿ')) {
            this.isLoading = true;

            // æ¨¡æ‹ŸæˆæƒæˆåŠŸ
            setTimeout(() => {
              this.isLoading = false;
              this.isLoggedIn = true;
              this.userInfo = {
                openid: 'wx_123456789',
                nickname: 'å¾®ä¿¡ç”¨æˆ·',
                sex: 1,
                province: 'å¹¿ä¸œçœ',
                city: 'æ·±åœ³å¸‚',
                country: 'ä¸­å›½',
                headimgurl: ''
              };
              this.loginTime = new Date().toLocaleString();
            }, 2000);
          } else {
            this.errorMessage = 'æ‚¨å·²å–æ¶ˆå¾®ä¿¡æˆæƒ';
          }
        },

        // é€€å‡ºç™»å½•
        logout () {
          this.isLoggedIn = false;
          this.userInfo = {};
          this.errorMessage = '';
        },

        // é‡æ–°å°è¯•ç™»å½•
        retryLogin () {
          this.errorMessage = '';
          this.wechatLogin();
        }
      }
    });
  </script>
</body>

</html>